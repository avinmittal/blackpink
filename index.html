<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday Aadya</title>

<!-- iPhone app mode (Safari â†’ Share â†’ Add to Home Screen) -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Aadya Bday">
<meta name="theme-color" content="#000000">

<link rel="preconnect" href="https://www.youtube.com">
<link rel="preconnect" href="https://www.youtube-nocookie.com">
<link rel="preconnect" href="https://www.google.com">
<link rel="preconnect" href="https://i.ytimg.com">

<style>
html, body { margin:0; padding:0; background:#000; height:100%; overflow:hidden; }
#stage { position:fixed; inset:0; background:#000; }
#player { width:100%; height:100%; }

/* Tight cut mask */
#fade{
  position:fixed; inset:0; background:#000; pointer-events:none;
  opacity:0; transition:opacity 120ms linear; z-index:40;
}
#fade.on{ opacity:1; }

/* Splash overlay (tap-to-start) */
#splash{
  position:fixed; inset:0;
  background: radial-gradient(circle at 50% 40%, rgba(255,255,255,0.12), rgba(0,0,0,0.95) 60%),
              linear-gradient(135deg, rgba(255,0,150,0.28), rgba(0,200,255,0.18));
  display:flex; align-items:center; justify-content:center; text-align:center;
  z-index:60; opacity:1; transform:scale(1.02);
  transition: opacity 140ms ease-out, transform 140ms ease-out;
}
#splash.off{ opacity:0; transform:scale(1); }

#splashText{
  font-family:-apple-system, system-ui, Segoe UI, Roboto, Arial;
  font-weight:900; letter-spacing:0.5px;
  font-size:clamp(34px, 6vw, 76px);
  line-height:1.05; color:#fff;
  text-shadow:0 10px 30px rgba(0,0,0,0.6);
  padding:0 18px;
}
#splashSub{ margin-top:10px; font-size:clamp(14px, 2vw, 20px); font-weight:700; opacity:0.95; }
</style>
</head>
<body>

<div id="stage"><div id="player"></div></div>
<div id="fade"></div>

<div id="splash">
  <div>
    <div id="splashText">Happy Birthday Aadya</div>
    <div id="splashSub">Tap anywhere to start ðŸŽ¶</div>
  </div>
</div>

<script>
const segments = [
  { videoId: "IHNzOHi8sJs", start: 0,  end: 24 },
  { videoId: "IHNzOHi8sJs", start: 66, end: 94 },
  { videoId: "2S24-y0Ij3Y", start: 59, end: 92 },
  { videoId: "bwmSjveL3Lc", start: 0,  end: 55 },
  { videoId: "bwmSjveL3Lc", start: 82, end: 113 }
];

// iOS tuning
const END_MARGIN_SEC = 0.14;
const POLL_MS = 110;

// Tight mask settings
const FADE_OUT_AT_END_SEC = 0.18;
const FADE_IN_AFTER_PLAY_MS = 60;

// Splash duration
const SPLASH_SHOW_MS = 1000;

let player;
let playerReady = false;
let pendingStart = false;

let segIndex = 0;
let monitoring = false;
let rafId = null;
let intervalId = null;
let started = false;
let fadingOut = false;

const fadeEl = document.getElementById("fade");
const splashEl = document.getElementById("splash");

const tag = document.createElement("script");
tag.src = "https://www.youtube.com/iframe_api";
document.head.appendChild(tag);

window.onYouTubeIframeAPIReady = () => {
  player = new YT.Player("player", {
    host: "https://www.youtube-nocookie.com",
    videoId: segments[0].videoId,
    playerVars: {
      playsinline: 1,
      rel: 0,
      modestbranding: 1,

      // Enable manual play/pause/seek in Home Screen mode
      controls: 1,

      disablekb: 1,
      origin: window.location.origin
    },
    events: {
      onReady: () => {
        playerReady = true;
        if (pendingStart) { pendingStart = false; startPlayback(); }
      },
      onStateChange
    }
  });
};

function onStateChange(e) {
  if (e.data === YT.PlayerState.PLAYING) {
    startMonitoring();
    setTimeout(fadeOff, FADE_IN_AFTER_PLAY_MS);
  }
  if (e.data === YT.PlayerState.BUFFERING) stopMonitoring();
  if (e.data === YT.PlayerState.PAUSED || e.data === YT.PlayerState.ENDED) stopMonitoring();
}

function fadeOn(){ fadeEl.classList.add("on"); }
function fadeOff(){ fadeEl.classList.remove("on"); fadingOut = false; }

function stopMonitoring() {
  monitoring = false;
  if (rafId) cancelAnimationFrame(rafId);
  rafId = null;
  if (intervalId) clearInterval(intervalId);
  intervalId = null;
}

function startMonitoring() {
  if (monitoring) return;
  monitoring = true;

  const check = () => {
    if (!monitoring) return;
    const s = segments[segIndex];
    const t = safeTime();

    if (!fadingOut && (s.end - t) <= FADE_OUT_AT_END_SEC) {
      fadingOut = true;
      fadeOn();
    }

    if (t >= s.end - END_MARGIN_SEC) { nextSegment(); return; }
    rafId = requestAnimationFrame(check);
  };

  rafId = requestAnimationFrame(check);

  intervalId = setInterval(() => {
    if (!monitoring) return;
    const s = segments[segIndex];
    const t = safeTime();

    if (!fadingOut && (s.end - t) <= FADE_OUT_AT_END_SEC) {
      fadingOut = true;
      fadeOn();
    }

    if (t >= s.end - END_MARGIN_SEC) nextSegment();
  }, POLL_MS);
}

function safeTime() {
  try { return player.getCurrentTime() || 0; } catch { return 0; }
}
function currentVideoId() {
  try { return player.getVideoData().video_id || ""; } catch { return ""; }
}

function playSegment(i) {
  segIndex = i;
  const s = segments[segIndex];
  stopMonitoring();
  fadeOn();

  const cur = currentVideoId();

  if (cur && cur === s.videoId) {
    try { player.seekTo(s.start, true); player.playVideo(); return; } catch {}
  }
  player.loadVideoById({ videoId: s.videoId, startSeconds: s.start });
}

function nextSegment() {
  stopMonitoring();
  const next = segIndex + 1;
  if (next >= segments.length) { fadeOn(); return; }
  playSegment(next);
}

function startPlayback() {
  if (started) return;
  if (!playerReady) { pendingStart = true; return; }
  started = true;

  // Must start immediately inside tap for iPhone autoplay policy
  fadeOn();
  playSegment(0);

  // Hide splash after 1s and remove from hit-testing so player controls work
  setTimeout(() => {
    splashEl.classList.add("off");
    setTimeout(() => { splashEl.style.display = "none"; }, 200);
  }, SPLASH_SHOW_MS);
}

// Buttonless: tap anywhere once
document.addEventListener("click", startPlayback, { once: true });
document.addEventListener("touchstart", startPlayback, { once: true });
</script>

</body>
</html>
