<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday Aadya</title>

<!-- iPhone "App mode" (use Safari â†’ Share â†’ Add to Home Screen for no address bar) -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Aadya Bday">
<meta name="theme-color" content="#000000">

<link rel="preconnect" href="https://www.youtube.com">
<link rel="preconnect" href="https://www.youtube-nocookie.com">
<link rel="preconnect" href="https://www.google.com">
<link rel="preconnect" href="https://i.ytimg.com">

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #000;
  height: 100%;
  overflow: hidden;
}

/* Stage */
#stage {
  position: fixed;
  inset: 0;
  background: #000;
}

/* Player fills screen */
#player {
  width: 100vw;
  height: 100vh;
}

/* Tight cut mask */
#fade {
  position: fixed;
  inset: 0;
  background: #000;
  pointer-events: none;
  opacity: 0;
  transition: opacity 120ms linear;
  z-index: 40;
}
#fade.on { opacity: 1; }

/* Confetti layer */
#confetti {
  position: fixed;
  inset: 0;
  pointer-events: none;
  opacity: 0;
  transition: opacity 80ms linear;
  z-index: 50;
}

/* 1-second splash */
#splash {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 50% 40%, rgba(255,255,255,0.12), rgba(0,0,0,0.95) 60%),
              linear-gradient(135deg, rgba(255,0,150,0.22), rgba(0,200,255,0.14));
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 60;
  opacity: 0;
  transform: scale(1.02);
  transition: opacity 140ms ease-out, transform 140ms ease-out;
}
#splash.on {
  opacity: 1;
  transform: scale(1);
}
#splashText {
  font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial;
  font-weight: 900;
  letter-spacing: 0.5px;
  font-size: clamp(34px, 6vw, 76px);
  line-height: 1.05;
  color: #fff;
  text-shadow: 0 10px 30px rgba(0,0,0,0.6);
  padding: 0 18px;
}
#splashSub {
  margin-top: 10px;
  font-size: clamp(14px, 2vw, 20px);
  font-weight: 600;
  opacity: 0.9;
}
</style>
</head>
<body>

<div id="stage">
  <div id="player"></div>
</div>

<canvas id="confetti"></canvas>
<div id="fade"></div>

<div id="splash">
  <div>
    <div id="splashText">Happy Birthday Aadya</div>
    <div id="splashSub">ðŸŽ‰ Letâ€™s party! ðŸŽ¶</div>
  </div>
</div>

<script>
/* ========= SEGMENTS ========= */
const segments = [
  { videoId: "IHNzOHi8sJs", start: 0,  end: 24 },
  { videoId: "IHNzOHi8sJs", start: 66, end: 94 },
  { videoId: "2S24-y0Ij3Y", start: 59, end: 92 },
  { videoId: "bwmSjveL3Lc", start: 0,  end: 55 },
  { videoId: "bwmSjveL3Lc", start: 82, end: 113 }
];

/* ========= iOS timing tuning ========= */
const END_MARGIN_SEC = 0.14;
const POLL_MS = 110;

/* ========= Sharp cut mask ========= */
const FADE_OUT_AT_END_SEC = 0.18;
const FADE_IN_AFTER_PLAY_MS = 60;

/* ========= Party extras ========= */
const SHOW_SPLASH_MS = 1000;        // 1-second intro splash
const CONFETTI_BURST_MS = 260;      // short burst between clips
const CONFETTI_FADE_MS = 110;

/* ========= State ========= */
let player;
let segIndex = 0;
let monitoring = false;
let rafId = null;
let intervalId = null;
let started = false;
let fadingOut = false;

const fadeEl = document.getElementById("fade");
const splashEl = document.getElementById("splash");
const confettiCanvas = document.getElementById("confetti");
const ctx = confettiCanvas.getContext("2d", { alpha: true });

/* ========= Confetti (simple, subtle, energetic) ========= */
let confettiParticles = [];
let confettiAnimating = false;
let confettiTimer = null;

function resizeConfetti() {
  confettiCanvas.width = Math.floor(window.innerWidth * devicePixelRatio);
  confettiCanvas.height = Math.floor(window.innerHeight * devicePixelRatio);
  confettiCanvas.style.width = window.innerWidth + "px";
  confettiCanvas.style.height = window.innerHeight + "px";
  ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
}
resizeConfetti();
window.addEventListener("resize", resizeConfetti);

function spawnConfettiBurst() {
  const w = window.innerWidth;
  const h = window.innerHeight;

  confettiParticles = [];
  const count = 90; // subtle but energetic
  for (let i = 0; i < count; i++) {
    const x = Math.random() * w;
    const y = -10 - Math.random() * 60;
    const size = 3 + Math.random() * 5;
    const speedY = 2.5 + Math.random() * 5.5;
    const driftX = (Math.random() - 0.5) * 2.2;
    const rot = Math.random() * Math.PI;
    const rotSpd = (Math.random() - 0.5) * 0.28;

    // bright party palette (no need for perfect accuracy)
    const colors = ["#ff2bd6", "#00e5ff", "#ffe600", "#7CFF00", "#ff6b00", "#ffffff"];
    const color = colors[(Math.random() * colors.length) | 0];

    confettiParticles.push({ x, y, size, speedY, driftX, rot, rotSpd, color, life: 1 });
  }

  confettiCanvas.style.opacity = "1";
  if (!confettiAnimating) {
    confettiAnimating = true;
    requestAnimationFrame(confettiLoop);
  }

  // fade out quickly
  clearTimeout(confettiTimer);
  confettiTimer = setTimeout(() => {
    confettiCanvas.style.transition = `opacity ${CONFETTI_FADE_MS}ms linear`;
    confettiCanvas.style.opacity = "0";
    setTimeout(() => {
      confettiParticles = [];
      ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
      confettiAnimating = false;
    }, CONFETTI_FADE_MS + 30);
  }, CONFETTI_BURST_MS);
}

function confettiLoop() {
  if (!confettiAnimating) return;

  const w = window.innerWidth;
  const h = window.innerHeight;
  ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);

  for (const p of confettiParticles) {
    p.y += p.speedY;
    p.x += p.driftX;
    p.rot += p.rotSpd;

    // Draw as small rotating rectangle
    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.rot);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.size * 0.6, -p.size * 0.4, p.size * 1.2, p.size * 0.8);
    ctx.restore();
  }

  // keep animating while particles exist
  const anyAlive = confettiParticles.some(p => p.y < h + 40);
  if (anyAlive) requestAnimationFrame(confettiLoop);
  else confettiAnimating = false;
}

/* ========= YouTube IFrame API ========= */
const tag = document.createElement("script");
tag.src = "https://www.youtube.com/iframe_api";
document.head.appendChild(tag);

window.onYouTubeIframeAPIReady = () => {
  player = new YT.Player("player", {
    host: "https://www.youtube-nocookie.com",
    videoId: segments[0].videoId,
    playerVars: {
      playsinline: 1,
      rel: 0,
      modestbranding: 1,
      controls: 0,
      fs: 0,
      disablekb: 1,
      origin: window.location.origin
    },
    events: { onStateChange }
  });
};

function onStateChange(e) {
  if (e.data === YT.PlayerState.PLAYING) {
    startMonitoring();
    setTimeout(() => fadeOff(), FADE_IN_AFTER_PLAY_MS);
  }
  if (e.data === YT.PlayerState.BUFFERING) stopMonitoring();
  if (e.data === YT.PlayerState.PAUSED || e.data === YT.PlayerState.ENDED) stopMonitoring();
}

/* ========= Fade helpers ========= */
function fadeOn()  { fadeEl.classList.add("on"); }
function fadeOff() { fadeEl.classList.remove("on"); fadingOut = false; }

/* ========= Monitor loop ========= */
function stopMonitoring() {
  monitoring = false;
  if (rafId) cancelAnimationFrame(rafId);
  rafId = null;
  if (intervalId) clearInterval(intervalId);
  intervalId = null;
}

function startMonitoring() {
  if (monitoring) return;
  monitoring = true;

  const check = () => {
    if (!monitoring) return;

    const s = segments[segIndex];
    const t = safeTime();

    // Tight mask right before cut
    if (!fadingOut && (s.end - t) <= FADE_OUT_AT_END_SEC) {
      fadingOut = true;
      fadeOn();
    }

    if (t >= s.end - END_MARGIN_SEC) {
      nextSegment();
      return;
    }

    rafId = requestAnimationFrame(check);
  };

  rafId = requestAnimationFrame(check);

  intervalId = setInterval(() => {
    if (!monitoring) return;
    const s = segments[segIndex];
    const t = safeTime();

    if (!fadingOut && (s.end - t) <= FADE_OUT_AT_END_SEC) {
      fadingOut = true;
      fadeOn();
    }

    if (t >= s.end - END_MARGIN_SEC) nextSegment();
  }, POLL_MS);
}

function safeTime() {
  try { return player.getCurrentTime() || 0; }
  catch { return 0; }
}

function currentVideoId() {
  try { return player.getVideoData().video_id || ""; }
  catch { return ""; }
}

/* ========= Playback ========= */
function playSegment(i) {
  segIndex = i;
  const s = segments[segIndex];
  stopMonitoring();

  // keep mask ON through any jump
  fadeOn();

  const cur = currentVideoId();

  if (cur && cur === s.videoId) {
    try {
      player.seekTo(s.start, true);
      player.playVideo();
      return;
    } catch {}
  }

  player.loadVideoById({ videoId: s.videoId, startSeconds: s.start });
}

function nextSegment() {
  stopMonitoring();
  const next = segIndex + 1;

  if (next >= segments.length) {
    fadeOn();
    try { player.pauseVideo(); } catch {}
    return;
  }

  // confetti pop between clips (short + subtle)
  spawnConfettiBurst();

  playSegment(next);
}

/* ========= Orientation helpers ========= */
function lockLandscape() {
  // Works on some devices; iPhone often ignoresâ€”fallback rotation below helps.
  if (screen.orientation && screen.orientation.lock) {
    screen.orientation.lock("landscape").catch(() => {});
  }

  // iPhone fallback: if portrait, rotate whole stage
  const stage = document.getElementById("stage");
  if (window.innerHeight > window.innerWidth) {
    stage.style.transform = "rotate(90deg)";
    stage.style.width = "100vh";
    stage.style.height = "100vw";
  } else {
    stage.style.transform = "none";
    stage.style.width = "100vw";
    stage.style.height = "100vh";
  }
}

/* ========= Start (tap anywhere once) ========= */
function startPlayback() {
  if (started) return;
  started = true;

  lockLandscape();

  // 1-second splash, then start the chain
  splashEl.classList.add("on");
  fadeOn();

  setTimeout(() => {
    splashEl.classList.remove("on");
    // tiny confetti at start for full party energy
    spawnConfettiBurst();
    playSegment(0);
  }, SHOW_SPLASH_MS);
}

document.addEventListener("click", startPlayback, { once: true });
document.addEventListener("touchstart", startPlayback, { once: true });

window.addEventListener("resize", () => {
  if (started) lockLandscape();
});
</script>

</body>
</html>
